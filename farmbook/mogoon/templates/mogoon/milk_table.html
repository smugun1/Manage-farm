{% extends 'mogoon/base.html' %}

{% include 'Milk/update.html' %}

{% include 'Milk/delete.html' %}

{% load static %}


<title>{% block title %}Milk Table{% endblock %}</title>

<link rel='stylesheet' href="{% static 'style.css' %}" type='text/css'>

{% block body %}
<div class="row g-4 d-flex align-items-center">
    <div class="col-lg-12 d-none d-lg-flex">
        <div class="container-fluid text-right card bg-secondary card-dark mx-4 px-4 my-4 py-4" style="border-radius: 10px;">
            <h2 class="text-center bg-dark text-light">Milk Records</h2>
            <div class="border p-3">
                <a class="btn btn-dark bg-primary btn-info block-lg"
                   href="{% url 'mogoon-milk_table_update'%}">Add</a>
                <a class="btn btn-dark bg-primary btn-info block-lg" href="{% url 'reports' %}">Go To Reports</a>
                <hr>
                <table class="table align-middle text-dark bg-light">
                    <tr>
                        <th>Milking Date</th>
                        <th>Milk Today</th>
                        <th>Milk Todate</th>
                        <th>Cows Milked</th>
                        <th>Cow Numbers</th>
                        <th>Milking Average</th>
                        <th>Total Milk</th>
                        <th>Edit</th>
                        <th>Delete</th>
                    </tr>

                    {% for data in Milk %}

                    <tr>
                        <td>{{data.milking_done}}</td>
                        <td>{{data.milk_today}}</td>
                        <td>{{data.milk_todate}}</td>
                        <td>{{data.cows_milked}}</td>
                        <td>{{data.cow_numbers}}</td>
                        <td>{{data.milking_average}}</td>
                        <td>{{data.total_milk}}</td>
                        <td><a class="btn btn-info btn-block bg-primary btn btn-info"
                               href="{% url 'milk-update' data.id %}">Edit</a></td>
                        <td><a class="btn btn-info btn-block bg-danger btn btn-info"
                               href="{% url 'milk-delete' data.id %}">Delete</a></td>
                        {% endfor %}
                    </tr>

                    <tr>
                        <td>TOTAL</td>
                        <td>{{ m_today }}</td>
                        <td>{{ m_todate }}</td>
                        <td>{{ c_milked.all_sum }}</td>
                        <td>{{ c_numbers.all_sum}}</td>
                        <td>{{m_average|floatformat:2}}</td>
                        <td>{{t_milk}}</td>

                    </tr>

                </table>
                <div class="col-md-3">
                    <div class="bg-white">
                        <canvas id="chartContainer" style="height: 300px;"></canvas>
                        <script>
                    // Ensure jQuery is noConflict mode to avoid conflicts
                        jQuery.noConflict();

                        jQuery(document).ready(function ($) {
                            // Function to extract data from the table and generate a chart
                            function generateChart() {
                                var labels = [];
                                var values = [];

                                // Loop through table rows (skip header and total/average row)
                               {% for data_entry in Milk %}
                                    labels.push('{{ data_entry.milking_done }}');
                                    values.push({{ data_entry.total_milk }});
                                {% endfor %}

                                // Chart.js configuration
                                var ctx = document.getElementById('chartContainer').getContext('2d');
                                var myChart = new Chart(ctx, {
                                    type: 'bar',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'Milk Records',
                                            data: values,
                                            backgroundColor: 'rgba(75, 192, 192, 1)',
                                            borderColor: 'rgba(75, 192, 192, 1)',
                                            borderWidth: 1
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true
                                            }
                                        }
                                    }
                                });
                            }

                            // Call the function to generate the chart
                            generateChart();
                        });

                        </script>
                    </div>
                </div>
                <hr>

                <br>
                <table class="table align-middle text-dark bg-light">
                    <tr>
                        <th>Calf Down Date</th>
                        <th>Today Date</th>
                        <th>Calf Age</th>
                        <th>Calf Numbers</th>
                        <th>Vet Cost</th>
                        <th>Total Vet Cost</th>
                        <th>Update</th>
                        <th>Delete</th>
                    </tr>

                    {% for data in Milk %}

                    <tr>
                        <td>{{data.calf_down}}</td>
                        <td>{{data.today}}</td>
                        <td>{{data.calf_age}}</td>
                        <td>{{data.calf_numbers}}</td>
                        <td>{{data.vet_cost}}</td>
                        <td>{{data.Total_vet_cost}}</td>
                        <td><a class="btn btn-info btn-block bg-primary btn btn-info"
                               href="{% url 'milk-update' data.id %}">Edit</a></td>
                        <td><a class="btn btn-info btn-block bg-danger btn btn-info"
                               href="{% url 'milk-delete' data.id %}">Delete</a></td>
                    </tr>
                    {% endfor %}

                    <tr>
                        <td>TOTAL</td>
                        <td></td>
                        <td>{{ cf_age }}</td>
                        <td></td>
                        <td>{{v_cost.all_sum}}</td>
                        <td>{{T_v_cost}}</td>
                    </tr>
                </table>
 <div class="col-md-3">
                    <div class="bg-white">
                        <canvas id="chartContainer1" style="height: 300px;"></canvas>
                        <script>
                    // Ensure jQuery is noConflict mode to avoid conflicts
                        jQuery.noConflict();

                        jQuery(document).ready(function ($) {
                            // Function to extract data from the table and generate a chart
                            function generateChart() {
                                var labels = [];
                                var values = [];

                                // Loop through table rows (skip header and total/average row)
                               {% for data_entry in Milk %}
                                    labels.push('{{ data_entry.today }}');
                                    values.push({{ data_entry.Total_vet_cost }});
                                {% endfor %}

                                // Chart.js configuration
                                var ctx = document.getElementById('chartContainer1').getContext('2d');
                                var myChart = new Chart(ctx, {
                                    type: 'bar',
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: 'Vet Costs',
                                            data: values,
                                            backgroundColor: 'rgba(75, 192, 192, 1)',
                                            borderColor: 'rgba(75, 192, 192, 1)',
                                            borderWidth: 1
                                        }]
                                    },
                                    options: {
                                        scales: {
                                            y: {
                                                beginAtZero: true
                                            }
                                        }
                                    }
                                });
                            }

                            // Call the function to generate the chart
                            generateChart();
                        });

                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr>
</div>
{% endblock %}